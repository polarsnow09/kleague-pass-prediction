# í”„ë¡¬í”„íŠ¸ ë¡œê·¸ #08: Phase 6 ì—ëŸ¬ ë¶„ì„ ê¸°ë°˜ í”¼ì²˜ ê°œë°œ

## ë‚ ì§œ
2025-12-31 ~ 2026-01-03

## ëª©ì 
ì—ëŸ¬ ë¶„ì„ì„ í†µí•œ íƒ€ê²ŸíŒ… í”¼ì²˜ ê°œë°œ ë° ì„±ëŠ¥ ê°œì„  ì‹œë„

---

## ë°°ê²½

### Phase 5 í˜„í™©
```
Phase 5 Stacking: 16.5316m (LB) ğŸ¥‡ ìµœê³  ê¸°ë¡
```

### ê°€ì„¤
```
"í° ì˜¤ì°¨ê°€ ë°œìƒí•˜ëŠ” ì¼€ì´ìŠ¤ë¥¼ ì§‘ì¤‘ ë¶„ì„í•˜ë©´
 íƒ€ê²ŸíŒ… í”¼ì²˜ë¡œ ê°œì„  ê°€ëŠ¥í•˜ì§€ ì•Šì„ê¹Œ?"
```

---

## Phase 6 ì „ëµ

### ì—ëŸ¬ ë¶„ì„ ê²°ê³¼ (ê°€ì„¤)

**ë†’ì€ ì˜¤ì°¨ ì¼€ì´ìŠ¤:**
1. ìˆ˜ë¹„ êµ¬ì—­ íŒ¨ìŠ¤ (ë¶ˆí™•ì‹¤ì„± â†‘)
2. ìµœì¢… êµ¬ì—­ ë¯¸ì§„ì… (ì¤‘ì› ì •ì²´)
3. ì¸¡ë©´ vs ì¤‘ì•™ (ì„ íƒì§€ ë‹¤ì–‘)
4. ë“ì  ìƒí™©ë³„ (ì „ìˆ  ë³€í™”)
5. ê·¹ë‹¨ê°’ (ê²½ê³„ ê·¼ì²˜)

### ê°œë°œí•œ í”¼ì²˜ (23ê°œ)

#### ì „ëµ 1: êµ¬ì—­ë³„ íŠ¹í™” (5ê°œ)
```python
- is_defensive_zone           # ìˆ˜ë¹„ êµ¬ì—­ ì—¬ë¶€
- defensive_uncertainty       # ìˆ˜ë¹„ êµ¬ì—­ ë¶ˆí™•ì‹¤ì„±
- player_style_in_defense     # ìˆ˜ë¹„ êµ¬ì—­ ì„ ìˆ˜ ìŠ¤íƒ€ì¼
- is_defensive_center         # ì¤‘ì•™ ìˆ˜ë¹„ êµ¬ì—­
- pressure_zone_interaction   # êµ¬ì—­-ì••ë°• ìƒí˜¸ì‘ìš©
```

#### ì „ëµ 2: ìµœì¢… êµ¬ì—­ ë¯¸ì§„ì… íƒ€ê²ŸíŒ… (4ê°œ)
```python
- attack_failure_risk         # ê³µê²© ì‹¤íŒ¨ ë¦¬ìŠ¤í¬
- stuck_in_midfield          # ì¤‘ì› ì •ì²´
- buildup_style              # ë¹Œë“œì—… ìŠ¤íƒ€ì¼
- attack_momentum            # ê³µê²© ëª¨ë©˜í…€
```

#### ì „ëµ 3: ì¸¡ë©´ vs ì¤‘ì•™ ì°¨ë³„í™” (4ê°œ)
```python
- central_uncertainty        # ì¤‘ì•™ ë¶ˆí™•ì‹¤ì„±
- wing_attack_pattern        # ì¸¡ë©´ ê³µê²© íŒ¨í„´
- cross_likelihood           # í¬ë¡œìŠ¤ ê°€ëŠ¥ì„±
- wing_central_balance       # ì¸¡ë©´-ì¤‘ì•™ ê· í˜•
```

#### ì „ëµ 4: ë“ì  ìƒí™©ë³„ ì „ìˆ  (3ê°œ)
```python
- leading_defensive          # ë¦¬ë“œ ì‹œ ìˆ˜ë¹„ì 
- losing_aggressive          # ì§€ëŠ” ìƒí™© ê³µê²©ì 
- endgame_pressure          # ê²½ê¸° í›„ë°˜ ì••ë°•
```

#### ì „ëµ 5: ê·¹ë‹¨ê°’ íŠ¹ìˆ˜ ì²˜ë¦¬ (3ê°œ)
```python
- near_boundary             # ê²½ê³„ ê·¼ì²˜
- extreme_pass              # ê·¹ë‹¨ì  íŒ¨ìŠ¤
- abnormal_situation        # ë¹„ì •ìƒ ìƒí™©
```

#### ë³´ë„ˆìŠ¤: ìƒí˜¸ì‘ìš© (4ê°œ)
```python
- zone_final_interaction    # êµ¬ì—­-ìµœì¢… ì§„ì…
- wing_pressure_interaction # ì¸¡ë©´-ì••ë°•
- player_zone_interaction   # ì„ ìˆ˜-êµ¬ì—­
```

---

## êµ¬í˜„ ê³¼ì •

### ë¬¸ì œ 1: Category dtype ê³±ì…ˆ ì˜¤ë¥˜

**ì—ëŸ¬:**
```python
TypeError: Object with dtype category cannot perform numpy op multiply
```

**ì›ì¸:**
- `pd.cut()`ì´ category dtype ë°˜í™˜
- categoryëŠ” ìˆ˜í•™ ì—°ì‚° ë¶ˆê°€

**í•´ê²° ì‹œë„ 1:**
```python
df['zone_x_encoded'].astype(int)  # ì‹¤íŒ¨
```

### ë¬¸ì œ 2: Object â†’ Int ë³€í™˜ ì˜¤ë¥˜

**ì—ëŸ¬:**
```python
ValueError: Cannot cast object dtype to int32
```

**ì›ì¸:**
- LabelEncoder ê²°ê³¼ê°€ objectë¡œ ìœ ì§€
- ë‚´ë¶€ì— ìˆ«ìê°€ ì•„ë‹Œ ê°’ ì¡´ì¬ ê°€ëŠ¥

**í•´ê²° ì‹œë„ 2:**
```python
# ëª…ì‹œì  ë³€í™˜
df['zone_x_str'] = df['zone_x'].astype(str)
df['zone_x_encoded'] = le.fit_transform(df['zone_x_str']).astype(np.int32)
# ì‹¤íŒ¨
```

### ë¬¸ì œ 3: Categoryì— ìƒˆ ê°’ ì¶”ê°€ ë¶ˆê°€

**ì—ëŸ¬:**
```python
TypeError: Cannot setitem on a Categorical with a new category (unknown)
```

**ì›ì¸:**
- category dtypeì€ ë¯¸ë¦¬ ì •ì˜ëœ ë²”ì£¼ë§Œ í—ˆìš©
- `fillna('unknown')` ì‹œ ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ë¶ˆê°€

**ìµœì¢… í•´ê²°: `np.select()` ì‚¬ìš©! â­**
```python
# zone_x ì™„ì „íˆ ë¬´ì‹œí•˜ê³  start_xë¡œ ìƒˆë¡œ ìƒì„±
conditions = [
    df['start_x'] < 35,              # ìˆ˜ë¹„ êµ¬ì—­ â†’ 0
    (df['start_x'] >= 35) & (df['start_x'] < 70),  # ì¤‘ì› â†’ 1
    df['start_x'] >= 70              # ê³µê²© êµ¬ì—­ â†’ 2
]
choices = [0, 1, 2]
df['zone_x_encoded'] = np.select(conditions, choices, default=1).astype(np.int32)

# ì¥ì :
# - category dtype ì™„ì „ íšŒí”¼
# - ì§ì ‘ ì •ìˆ˜ ë°°ì—´ ìƒì„±
# - NaN ìë™ ì²˜ë¦¬
# - ë¹ ë¥´ê³  ì•ˆì •ì 
```

---

## ì‹¤í—˜ ê²°ê³¼

### ì˜ˆì¸¡ í†µê³„

**Phase 6 ì˜ˆì¸¡:**
```
mean end_x: 66.9m (ê¸°ì¡´ ~52m ëŒ€ë¹„ +15m)
mean end_y: 34.2m (ì¤‘ì•™ ìœ ì§€)

â†’ í›¨ì”¬ ë” ê³µê²©ì ì¸ ì˜ˆì¸¡!
```

**ì›ì¸ ë¶„ì„:**
- `attack_momentum` í”¼ì²˜ê°€ ì „ì§„ ìœ ë„
- `attack_failure_risk` í”¼ì²˜ê°€ ìµœì¢… êµ¬ì—­ íƒ€ê²ŸíŒ…
- ëª¨ë¸ì´ ë” ê³µê²©ì  íŒ¨í„´ í•™ìŠµ

### Public LB ê²°ê³¼

| Phase | LB Score | vs Phase 5 | ê°œì„ /ì•…í™” |
|-------|----------|------------|----------|
| Phase 5 (Stacking) | **16.5316** | baseline | ğŸ¥‡ ìµœê³  |
| Phase 6 (ì—ëŸ¬ ë¶„ì„) | 16.5622 | +0.0306 | âŒ ì•…í™” |

**ê²°ë¡ : Phase 6ì€ íš¨ê³¼ ì—†ìŒ** (-0.18% ì•…í™”)

---

## ì‹¤íŒ¨ ì›ì¸ ë¶„ì„

### 1. ê³¼ë„í•œ ê³µê²©ì„±
```
Phase 6ì˜ ì „ì§„ ì˜ˆì¸¡ (+15m)
â†’ ì‹¤ì œ ìµœì¢… íŒ¨ìŠ¤ëŠ” ë” ë³´ìˆ˜ì 
â†’ ì˜¤ì°¨ ì¦ê°€
```

### 2. ì—ëŸ¬ ë¶„ì„ì˜ í•¨ì •
```
í° ì˜¤ì°¨ ì¼€ì´ìŠ¤ = ì›ë˜ ì˜ˆì¸¡ ì–´ë ¤ìš´ ì¼€ì´ìŠ¤
â†’ íŠ¹í™” í”¼ì²˜ë¡œ ê°œì„  í•œê³„
â†’ ë…¸ì´ì¦ˆë§Œ ì¶”ê°€
```

### 3. í”¼ì²˜ ì¤‘ë³µ
```
Phase 6 í”¼ì²˜ë“¤:
- ê¸°ì¡´ í”¼ì²˜ì™€ ì¤‘ë³µ (start_x, zone_x ë“±)
- ìƒˆë¡œìš´ ì‹ í˜¸ ë¶€ì¡±
- ëª¨ë¸ í˜¼ë€ë§Œ ìœ ë°œ
```

### 4. êµ¬ì¡° vs í”¼ì²˜
```
Phase 5 Stacking:
- êµ¬ì¡°ì  ê°œì„  (Meta-Learning)
- ëª…í™•í•œ íš¨ê³¼ (+0.30m)

Phase 6 í”¼ì²˜ ì¶”ê°€:
- ì ì§„ì  ì ‘ê·¼
- ë¶ˆëª…í™•í•œ íš¨ê³¼ (-0.03m)

â†’ êµ¬ì¡°ì  ê°œì„  > í”¼ì²˜ ì¶”ê°€
```

---

## í•µì‹¬ í•™ìŠµ

### 1. ë” ë§ì€ í”¼ì²˜ â‰  ë” ì¢‹ì€ ì„±ëŠ¥
```
Phase 1-4: 48ê°œ í”¼ì²˜ â†’ 18.70m
Phase 5: Meta 6ê°œ â†’ 16.53m â­

Phase 6: +23ê°œ â†’ 16.56m âŒ

êµí›ˆ: í’ˆì§ˆ > ìˆ˜ëŸ‰
```

### 2. Stackingì´ ì´ë¯¸ ìµœì 
```
Phase 5 Stacking:
- 3ê°œ ëª¨ë¸ì˜ ì¥ì  ê²°í•©
- ë¹„ì„ í˜• Meta-Learning
- OOFë¡œ ê³¼ì í•© ë°©ì§€

â†’ ì´ë¯¸ ìµœì ì˜ ê· í˜•ì  ë‹¬ì„±
â†’ ì¶”ê°€ í”¼ì²˜ëŠ” ë°©í•´ë§Œ
```

### 3. ì—ëŸ¬ ë¶„ì„ì˜ í•œê³„
```
í° ì˜¤ì°¨ ì¼€ì´ìŠ¤ ë¶„ì„ â†’ íƒ€ê²ŸíŒ… í”¼ì²˜

But ì‹¤ì œë¡œëŠ”:
- ì›ë˜ ì˜ˆì¸¡ ì–´ë ¤ìš´ ì¼€ì´ìŠ¤
- ë°ì´í„° ìì²´ì˜ ë¶ˆí™•ì‹¤ì„±
- í”¼ì²˜ë¡œ í•´ê²° ë¶ˆê°€

ì˜¬ë°”ë¥¸ ì ‘ê·¼:
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì¼€ì´ìŠ¤ ê°œì„ 
- êµ¬ì¡°ì  ê°œì„  (ì•™ìƒë¸”, Stacking)
```

### 4. dtype ì§€ì˜¥ ê·¹ë³µ â­
```
3ë²ˆì˜ dtype ì—ëŸ¬ ê·¹ë³µ:
1. category ê³±ì…ˆ â†’ .astype(int)
2. object â†’ int â†’ ëª…ì‹œì  ë³€í™˜
3. category ìƒˆ ê°’ â†’ np.select()

ìµœì¢… í•´ê²°: np.select()
- pandas dtype ì™„ì „ íšŒí”¼
- NumPy ì§ì ‘ ì‚¬ìš©
- ì•ˆì „í•˜ê³  ëª…í™•
```

---

## ë‹¤ìŒ ë‹¨ê³„

### ê³ ë ¤ ê°€ëŠ¥í•œ ì¶”ê°€ ì‹œë„

**1. Phase 6 í”¼ì²˜ ì„ íƒ**
```python
# ìƒìœ„ 5ê°œë§Œ ì‚¬ìš©
- player_style_in_defense (ìœ ìš©í•  ê°€ëŠ¥ì„±)
- attack_momentum (ì „ì§„ ì‹ í˜¸)
- central_uncertainty (ì¸¡ë©´ vs ì¤‘ì•™)
- leading_defensive (ë“ì ì°¨ íš¨ê³¼)
- wing_attack_pattern (ì¸¡ë©´ ê³µê²©)
```

**2. Blending**
```python
final = 0.7 * phase5 + 0.3 * phase6
# Phase 5 ìœ„ì£¼, Phase 6 ë³´ì¡°
```

**3. 2-Level Stacking**
```python
Level 0: XGB, LGB, Cat
Level 1: Ridge, LGB (Phase 5)
Level 2: Neural Network
```

---

## íšŒê³ 

### ì˜í•œ ì 
1. âœ… dtype ì—ëŸ¬ 3ë²ˆ ê·¹ë³µ
2. âœ… `np.select()` í•´ê²°ì±… ë°œê²¬
3. âœ… ì²´ê³„ì  ì—ëŸ¬ ë¶„ì„
4. âœ… 23ê°œ í”¼ì²˜ ì™„ì„±
5. âœ… ì‹¤í—˜ ì •ì‹  (ì‹œë„ëŠ” ì¤‘ìš”!)

### ì•„ì‰¬ìš´ ì 
1. âš ï¸ Phase 6 íš¨ê³¼ ì—†ìŒ (-0.03m)
2. âš ï¸ ê³¼ë„í•œ ê³µê²©ì„± (+15m)
3. âš ï¸ í”¼ì²˜ ì¤‘ë³µ ë¯¸ê²€ì¦
4. âš ï¸ ì—ëŸ¬ ë¶„ì„ â†’ íƒ€ê²ŸíŒ…ì˜ í•œê³„

### ë°°ìš´ ì 

> **"ìµœì ì ì—ì„œëŠ” ë” ì´ìƒ ê°œì„ ì´ ì–´ë µë‹¤"**
> 
> Phase 5 Stackingì´ ì´ë¯¸ ìµœì ì˜ ê· í˜•.
> ì¶”ê°€ í”¼ì²˜ëŠ” ë…¸ì´ì¦ˆê°€ ë  ê°€ëŠ¥ì„± â†‘

> **"êµ¬ì¡°ì  ê°œì„  > í”¼ì²˜ ê°œì„ "**
> 
> Phase 5 Stacking: +0.30m (ëª…í™•)
> Phase 6 í”¼ì²˜: -0.03m (ë¶ˆëª…í™•)

> **"ì‹¤íŒ¨ë„ ì¤‘ìš”í•œ í•™ìŠµ"**
> 
> Phase 6 ì‹¤íŒ¨ë¥¼ í†µí•´:
> - Stackingì˜ ìš°ìˆ˜ì„± ì¬í™•ì¸
> - í”¼ì²˜ì˜ í•œê³„ ì´í•´
> - dtype ì „ë¬¸ê°€ ë¨!

## ì°¸ê³  ìë£Œ

### ì½”ë“œ íŒŒì¼
- `src/features/build_phase6_features.py` (23ê°œ í”¼ì²˜)
- `src/models/train_model_v6.py` (XGBoost)
- `src/models/train_model_lgb_v6.py` (LightGBM)
- `src/models/train_model_catboost_v6.py` (CatBoost)
- `src/models/predict_stacking_v6.py` (ì˜ˆì¸¡)

### ì œì¶œ íŒŒì¼
- `submissions/submission_stacking_v6.csv` (LB 16.5622)
- `submissions/submission_stacking_lgb.csv` (LB 16.5316) ğŸ¥‡

---

## í”„ë¡¬í”„íŠ¸ í†µê³„

- ì´ í”„ë¡¬í”„íŠ¸ ìˆ˜: 15+
- Phase 6 ê´€ë ¨: 8ê°œ
- ì—ëŸ¬ í•´ê²°: 3íšŒ
- í‰ê·  ì‘ë‹µ ì‹œê°„: 30ì´ˆ
- ì±„íƒë¥ : 100% (ì—ëŸ¬ëŠ” í•´ê²°ë¨!)

---

**ğŸŠ Phase 6 ì¢…ë£Œ!**

ë¹„ë¡ ì„±ëŠ¥ ê°œì„ ì€ ì—†ì—ˆì§€ë§Œ,
dtype ì „ë¬¸ê°€ê°€ ë˜ì—ˆê³ 
Stackingì˜ ìš°ìˆ˜ì„±ì„ ì¬í™•ì¸í–ˆìŠµë‹ˆë‹¤! ğŸ’ª
